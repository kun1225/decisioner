# G-18 Authentication and Session Security

> **Phase:** 1.0 | **Status:** Not Started
> **Specs:** [API &sect;5.2](../specs/5-api-design.md) &middot; [Data](../specs/6-data-model.md) &middot; [Frontend &sect;4.1](../specs/4-frontend-architecture.md)

## Goal Statement

使用者可以安全登入並維持可控的登入狀態。

## Requirement

系統必須提供帳號登入、refresh rotation、token reuse 防護與基本授權邊界。

## In Scope

1. Local register/login
2. Google idToken login
3. Access token + refresh token rotation
4. `/auth/me` session restore
5. Logout revoke

## Out Scope

1. 多因子驗證（MFA）
2. SSO enterprise federation

## Frontend Elements

1. 註冊/登入表單
2. Google 登入按鈕
3. Session restore 載入狀態
4. 登出入口與重新登入提示

## Acceptance Criteria

- [ ] Given 新使用者註冊成功，When 使用者登入，Then 取得 access token 與 refresh cookie。
- [ ] Given access token 過期，When 呼叫 refresh，Then 舊 refresh token 被撤銷並簽發新 token。
- [ ] Given 偵測到 revoked refresh token reuse，When 服務處理該請求，Then 同 family token 被撤銷並要求重新登入。
- [ ] Given 使用者呼叫 logout，When 完成登出，Then refresh token 不可再用於換發。

## Tasks

- [ ] Auth API（register / login / google / refresh / logout / me）
- [ ] Refresh token rotation + reuse detection（DB + 邏輯）
- [ ] Page-oriented frontend structure（route-first 目錄 + providers 單一入口 + src/lib）
- [ ] Global site header（brand + nav + auth action + mobile menu trigger）
- [ ] Auth 前端（登入/註冊表單 + Google 按鈕 + session restore）
